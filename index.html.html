<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kaiwu FluentPro — Business Mandarin Mini Course</title>
  <meta name="description" content="Beginner‑friendly Business Mandarin: real phrases for greetings, calls, meetings, and negotiation — with built‑in audio (browser TTS) and optional MP3 fallback."/>
  <style>
    :root{
      --bg:#0b0b0f; --card:#12121a; --ink:#f5f5f7; --muted:#a1a1b0; --line:#222233;
      --accent:#dc2626; --accent2:#f43f5e; --pill:#1b1b25;
    }
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans";line-height:1.6}
    .wrap{max-width:1100px;margin:auto;padding:24px}
    header.hero{background:linear-gradient(180deg,#11111a,#0d0d14);border:1px solid var(--line);border-radius:24px;padding:28px 24px;margin:18px 0 28px;position:relative;overflow:hidden}
    header.hero:after{content:"";position:absolute;inset:-20% -10% auto -10%;height:420px;background:
      radial-gradient(900px 220px at 15% 0%, rgba(220,38,38,.18), transparent 60%),
      radial-gradient(900px 220px at 85% 100%, rgba(244,63,94,.14), transparent 60%);
      pointer-events:none}
    .title{font-size:clamp(28px,5.5vw,52px);font-weight:900;letter-spacing:-.02em;margin:0 0 8px}
    .sub{font-size:clamp(15px,2.4vw,20px);color:var(--muted);max-width:720px;margin:0}
    .row{display:flex;gap:14px;flex-wrap:wrap;align-items:center;margin-top:14px}
    .btn{display:inline-flex;align-items:center;gap:10px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:12px 16px;border-radius:14px;font-weight:800;text-decoration:none;box-shadow:0 10px 28px rgba(220,38,38,.4)}
    .pill{background:var(--pill);border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:#d4d4dd;font-size:12px}
    .bar{display:flex;gap:14px;flex-wrap:wrap;align-items:center;color:var(--muted);font-size:14px;margin-top:10px}

    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:6px 0 22px}
    .controls select,.controls input[type="range"], .controls button{background:#0f0f16;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:8px 10px}
    .controls label{font-size:12px;color:var(--muted)}

    .unit{border:1px solid var(--line);background:var(--card);border-radius:18px;margin:20px 0;padding:16px}
    .unit h2{margin:0 0 8px;font-size:20px}
    .grid{display:grid;grid-template-columns: 1.2fr 1.2fr 1.6fr auto;gap:8px;align-items:center}
    .grid.header{font-weight:700;color:#d8d8df}
    .rowline{border-top:1px dashed #1f1f2e;margin:6px 0}
    .mute{color:var(--muted)}
    .play{cursor:pointer;border:1px solid var(--line);background:#0d0d15;border-radius:10px;padding:6px 10px}
    .play:hover{border-color:#2a2a3c}

    .dialog{border:1px dashed #2a2a3a;border-radius:14px;padding:12px;margin-top:10px;background:#0f0f16}
    .dialog h3{margin:0 0 6px;font-size:16px}
    .dialog .line{display:flex;gap:8px}

    .notice{font-size:12px;color:var(--muted)}

    .sticky{position:fixed;right:16px;bottom:16px;display:flex;gap:10px;flex-direction:column}
    .sticky a{background:#111119;border:1px solid var(--line);padding:10px 12px;border-radius:12px;color:#fff;text-decoration:none}

    .hide-en .col-en{display:none}
    .hide-py .col-py{display:none}
    .kbd{font:inherit;background:#111119;border:1px solid var(--line);border-radius:8px;padding:2px 6px;color:#d7d7de}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <div class="pill">Kaiwu FluentPro — Business Mandarin</div>
      <h1 class="title">Real Work Situations Only 💼</h1>
      <p class="sub">Speak Business Mandarin, not textbook. Click ▶️ to hear every phrase (built‑in browser TTS in zh‑CN). Optionally add your own MP3s.</p>
      <div class="row">
        <a class="btn" href="https://wa.me/6281770250232?text=Hi%20Kaiwu%2C%20I%27d%20love%20the%205-min%20Career%20Assessment." target="_blank" rel="noopener">Secure my spot now 🎟️</a>
        <span class="pill">6‑Week Sprint</span>
        <span class="pill">Beginner‑friendly</span>
        <span class="pill">Refund in 14 days</span>
      </div>
      <div class="bar">
        <span>Next Cohort: <strong id="cohort-date">(auto)</strong></span>
        <span>•</span>
        <span><strong id="spots-left">5</strong> spots left</span>
        <span>•</span>
        <span class="notice">Tip: First tap a ▶️ to unlock audio on some mobile browsers.</span>
      </div>
    </header>

    <section class="controls" id="audioControls">
      <label>Voice: <select id="voiceSel"></select></label>
      <label>Rate <span class="kbd" id="rateVal">1.0</span> <input id="rate" type="range" min="0.6" max="1.2" step="0.05" value="1.0"></label>
      <label>Pitch <span class="kbd" id="pitchVal">1.0</span> <input id="pitch" type="range" min="0.8" max="1.2" step="0.05" value="1.0"></label>
      <button id="togglePy">Hide Pinyin</button>
      <button id="toggleEn">Hide English</button>
      <button id="playAll">Play All (Unit 1)</button>
    </section>

    <!-- Units will render here -->
    <div id="course"></div>

    <p class="notice">Audio notes: Uses <strong>SpeechSynthesis</strong> (zh‑CN) for instant playback. To replace any line with studio audio, add an MP3 path in the data and the player will prefer it.</p>

    <section class="unit">
      <h2>Countdown</h2>
      <div id="cd" class="row">
        <div><strong id="cd-days">00</strong> <span class="mute">Days</span></div>
        <div><strong id="cd-hours">00</strong> <span class="mute">Hours</span></div>
        <div><strong id="cd-mins">00</strong> <span class="mute">Minutes</span></div>
        <div><strong id="cd-secs">00</strong> <span class="mute">Seconds</span></div>
      </div>
    </section>
  </div>

  <div class="sticky">
    <a href="#top" onclick="window.scrollTo({top:0,behavior:'smooth'});return false;">↑ Back to top</a>
    <a href="https://wa.me/6281770250232?text=Hi%20Kaiwu%2C%20I%27d%20love%20the%205-min%20Career%20Assessment." target="_blank" rel="noopener">WhatsApp me</a>
  </div>

  <script>
    // ====== DATA ======
    const UNITS = [
      {
        title: "Unit 1 — Greetings & Introductions",
        phrases: [
          {hanzi:"你好。", py:"nǐ hǎo.", en:"Hello.", mp3:null},
          {hanzi:"您好。", py:"nín hǎo.", en:"Hello (polite).", mp3:null},
          {hanzi:"早上好。/ 下午好。/ 晚上好。", py:"zǎo shang hǎo. / xià wǔ hǎo. / wǎn shang hǎo.", en:"Good morning / afternoon / evening.", mp3:null},
          {hanzi:"我是凯吴。", py:"wǒ shì Kǎi Wú.", en:"I'm Kaiwu.", mp3:null},
          {hanzi:"我在开悟公司工作。", py:"wǒ zài Kāiwù gōngsī gōngzuò.", en:"I work at Kaiwu Company.", mp3:null},
          {hanzi:"很高兴认识您。", py:"hěn gāoxìng rènshi nín.", en:"Nice to meet you (polite).", mp3:null},
          {hanzi:"请多指教。", py:"qǐng duō zhǐjiào.", en:"Please advise / Let's work well together.", mp3:null},
          {hanzi:"我们开始吧。", py:"wǒmen kāishǐ ba.", en:"Let's get started.", mp3:null}
        ],
        dialogues: [
          {title:"Intro at a meeting",
           lines:[
            "A：您好，我是李明，采购经理。",
            "B：您好，我是王珊，项目负责人。很高兴认识您。",
            "A：今天的目标是确认时间表。我们开始吧。"
           ]}
        ]
      },
      {
        title: "Unit 2 — Calls & Clarification",
        phrases: [
          {hanzi:"现在方便通话吗？", py:"xiànzài fāngbiàn tōnghuà ma?", en:"Is now a good time to talk?", mp3:null},
          {hanzi:"我这边信号不太好。", py:"wǒ zhèbiān xìnhào bú tài hǎo.", en:"My signal isn't great.", mp3:null},
          {hanzi:"您能说慢一点吗？", py:"nín néng shuō màn yìdiǎn ma?", en:"Could you speak a little slower?", mp3:null},
          {hanzi:"刚才那一项，能再解释一下吗？", py:"gāngcái nà yí xiàng, néng zài jiěshì yíxià ma?", en:"Could you explain that item again?", mp3:null},
          {hanzi:"我确认一下，然后回复您。", py:"wǒ quèrèn yíxià, ránhòu huífù nín.", en:"I'll confirm and get back to you.", mp3:null},
          {hanzi:"稍等一下。", py:"shāo děng yíxià.", en:"One moment, please.", mp3:null},
          {hanzi:"我发封邮件跟进。", py:"wǒ fā fēng yóujiàn gēnjìn.", en:"I'll follow up by email.", mp3:null}
        ],
        dialogues: [
          {title:"Phone check‑in",
           lines:[
            "A：现在方便通话吗？",
            "B：方便。刚才那一项，我再解释一下……",
            "A：好的，我确认一下，然后邮件跟进。"
           ]}
        ]
      },
      {
        title: "Unit 3 — Meetings, Updates & Next Steps",
        phrases: [
          {hanzi:"今天的目标是……", py:"jīntiān de mùbiāo shì…", en:"Today's goal is…", mp3:null},
          {hanzi:"先说一下进度。", py:"xiān shuō yíxià jìndù.", en:"Let me share a quick update.", mp3:null},
          {hanzi:"目前最大的挑战是……", py:"mùqián zuìdà de tiǎozhàn shì…", en:"Our biggest challenge right now is…", mp3:null},
          {hanzi:"这个时间可以吗？", py:"zhè ge shíjiān kěyǐ ma?", en:"Does this timing work?", mp3:null},
          {hanzi:"我们可以提前/推迟一点吗？", py:"wǒmen kěyǐ tíqián / tuīchí yìdiǎn ma?", en:"Can we move it earlier/later a bit?", mp3:null},
          {hanzi:"我同意。/ 我有不同的看法。", py:"wǒ tóngyì. / wǒ yǒu bùtóng de kànfǎ.", en:"I agree. / I see it differently.", mp3:null},
          {hanzi:"接下来怎么做？", py:"jiēxiàlái zěnme zuò?", en:"What are the next steps?", mp3:null},
          {hanzi:"谢谢大家。", py:"xièxie dàjiā.", en:"Thank you, everyone.", mp3:null}
        ],
        dialogues: [
          {title:"Weekly status",
           lines:[
            "A：先说一下进度。目前最大的挑战是测试环境。",
            "B：这个时间可以吗？我们可以推迟两天。",
            "A：好的。接下来怎么做？"
           ]}
        ]
      }
    ];

    // ====== RENDER ======
    const courseEl = document.getElementById('course');
    UNITS.forEach((u, uIdx) => {
      const sec = document.createElement('section');
      sec.className = 'unit';
      sec.innerHTML = `<h2>${u.title}</h2>
        <div class="grid header"><div>汉字</div><div class="col-py">拼音</div><div class="col-en">English</div><div></div></div>`;
      u.phrases.forEach((p, i) => {
        const row = document.createElement('div');
        row.className = 'grid';
        row.innerHTML = `
          <div>${p.hanzi}</div>
          <div class="col-py mute">${p.py}</div>
          <div class="col-en mute">${p.en}</div>
          <div><button class="play" data-u="${uIdx}" data-i="${i}">▶️ Play</button></div>
        `;
        sec.appendChild(row);
      });
      // Dialogues
      if (u.dialogues?.length) {
        u.dialogues.forEach(d => {
          const box = document.createElement('div');
          box.className = 'dialog';
          box.innerHTML = `<h3>Dialogue — ${d.title}</h3>` + d.lines.map(line=>`<div class="line">${line}</div>`).join('') +
            `<div style="margin-top:8px"><button class="play play-dialog">▶️ Play Dialogue</button></div>`;
          sec.appendChild(box);
        });
      }
      courseEl.appendChild(sec);
    });

    // ====== AUDIO (TTS with optional MP3 fallback) ======
    const rate = document.getElementById('rate');
    const pitch = document.getElementById('pitch');
    const rateVal = document.getElementById('rateVal');
    const pitchVal = document.getElementById('pitchVal');
    const voiceSel = document.getElementById('voiceSel');

    let VOICES = [];
    let ZH_VOICE = null;
    let isSpeaking = false;

    function loadVoices(){
      VOICES = window.speechSynthesis ? speechSynthesis.getVoices() : [];
      voiceSel.innerHTML = '';
      VOICES.filter(v=>/zh/i.test(v.lang)).forEach((v,idx)=>{
        const opt = document.createElement('option');
        opt.value = v.name; opt.textContent = `${v.name} (${v.lang})`;
        voiceSel.appendChild(opt);
        if (!ZH_VOICE) ZH_VOICE = v;
      });
      if (!ZH_VOICE && VOICES.length){ ZH_VOICE = VOICES[0]; }
      if (ZH_VOICE){ voiceSel.value = ZH_VOICE.name; }
    }

    if ('speechSynthesis' in window){
      loadVoices();
      window.speechSynthesis.onvoiceschanged = loadVoices;
    }

    voiceSel.addEventListener('change', ()=>{
      const name = voiceSel.value;
      ZH_VOICE = VOICES.find(v=>v.name===name) || ZH_VOICE;
    });

    function speakText(text){
      return new Promise((resolve)=>{
        // Try MP3 route? (not per line here; handled individually in click)
        if (!('speechSynthesis' in window) || !ZH_VOICE){
          console.warn('No TTS voice available.');
          resolve();
          return;
        }
        const u = new SpeechSynthesisUtterance(text);
        u.voice = ZH_VOICE; u.rate = parseFloat(rate.value)||1; u.pitch = parseFloat(pitch.value)||1;
        u.onend = ()=>{ isSpeaking=false; resolve(); };
        u.onerror = ()=>{ isSpeaking=false; resolve(); };
        isSpeaking=true;
        speechSynthesis.speak(u);
      });
    }

    // Handle Play clicks
    document.addEventListener('click', async (e)=>{
      const btn = e.target.closest('.play');
      if (!btn) return;

      // Dialogue playback
      if (btn.classList.contains('play-dialog')){
        const lines = Array.from(btn.closest('.dialog').querySelectorAll('.line')).map(el=>el.textContent.replace(/^([AB]：)/,''));
        for (const ln of lines){
          await speakText(ln);
          await new Promise(r=>setTimeout(r,180));
        }
        return;
      }

      const uIdx = +btn.dataset.u; const i = +btn.dataset.i;
      const item = UNITS[uIdx].phrases[i];
      // Prefer MP3 if provided
      if (item.mp3){
        const a = new Audio(item.mp3); a.play();
      } else {
        await speakText(item.hanzi);
      }
    });

    rate.addEventListener('input', ()=> rateVal.textContent = rate.value);
    pitch.addEventListener('input', ()=> pitchVal.textContent = pitch.value);

    // Play All (Unit 1)
    document.getElementById('playAll').addEventListener('click', async ()=>{
      const list = UNITS[0].phrases;
      for (const p of list){ await speakText(p.hanzi); await new Promise(r=>setTimeout(r,180)); }
    });

    // Toggle pinyin / English
    const root = document.body;
    const pyBtn = document.getElementById('togglePy');
    const enBtn = document.getElementById('toggleEn');
    let showPy = true, showEn = true;
    function applyToggles(){ root.classList.toggle('hide-py', !showPy); root.classList.toggle('hide-en', !showEn); }
    pyBtn.addEventListener('click', ()=>{ showPy=!showPy; pyBtn.textContent = (showPy? 'Hide':'Show')+ ' Pinyin'; applyToggles(); });
    enBtn.addEventListener('click', ()=>{ showEn=!showEn; enBtn.textContent = (showEn? 'Hide':'Show')+ ' English'; applyToggles(); });

    // ====== Cohort date & countdown ======
    function getNextCohortDate(){
      const today=new Date(); let c=new Date(); c.setDate(today.getDate()+12); while(c.getDay()!==1){ c.setDate(c.getDate()+1); } return c;
    }
    function pad2(n){ return String(n).padStart(2,'0'); }
    const cohortDate = getNextCohortDate();
    const dateEl = document.getElementById('cohort-date'); if (dateEl) dateEl.textContent = cohortDate.toLocaleDateString('id-ID',{year:'numeric',month:'long',day:'numeric'});

    const targetTs = new Date(cohortDate.toISOString().slice(0,10)+'T09:00:00+07:00').getTime();
    const dEl=document.getElementById('cd-days'), hEl=document.getElementById('cd-hours'), mEl=document.getElementById('cd-mins'), sEl=document.getElementById('cd-secs');
    function tick(){
      const now=Date.now(); let diff=targetTs-now; if(diff<0){ return; }
      const day=86400000, hr=3600000, min=60000;
      dEl.textContent = pad2(Math.floor(diff/day));
      hEl.textContent = pad2(Math.floor((diff%day)/hr));
      mEl.textContent = pad2(Math.floor((diff%hr)/min));
      sEl.textContent = pad2(Math.floor((diff%min)/1000));
    }
    tick(); setInterval(tick,1000);
  </script>
</body>
</html>
